# Add this route to app/projects.py after the assign() function (around line 232)

@projects_bp.route('/<int:project_id>/submit_delivery', methods=['POST'])
@login_required
def submit_delivery(project_id):
    """Creator submits delivery via Drive link"""
    project = Project.query.get_or_404(project_id)
    
    # Only assigned creator can submit delivery
    if current_user.id != project.assigned_to_id:
        return jsonify({'error': 'Unauthorized'}), 403
    
    # Check if project is assigned
    if project.status != 'assigned':
        return jsonify({'error': 'Project is not in assigned status'}), 400
    
    delivery_link = request.form.get('delivery_link', '').strip()
    delivery_note = request.form.get('delivery_note', '').strip()
    
    # Validate link
    if not delivery_link:
        return jsonify({'error': 'Delivery link is required'}), 400
    
    # Validate link is from allowed domains
    allowed_domains = ['drive.google.com', 'dropbox.com', 'onedrive.live.com', '1drv.ms']
    if not any(domain in delivery_link.lower() for domain in allowed_domains):
        return jsonify({'error': 'Please use Google Drive, Dropbox, or OneDrive links only'}), 400
    
    # Update project
    project.delivery_link = delivery_link
    project.delivery_note = delivery_note
    project.delivered_at = datetime.utcnow()
    project.status = 'delivered'
    
    db.session.commit()
    
    flash('Delivery submitted successfully!', 'success')
    return jsonify({'success': True}), 200
